<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Klein Bottle</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="style.css" rel="stylesheet" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="underscore.js"></script>

<script src="util.js"></script>
<script src="math.js"></script>
<script src="shapes.js"></script>
<script src="n22d.js"></script>
<script src="ui.js"></script>

<style type="text/css">
    html, body {
        height: 100%;
    }
</style>

<script type="text/javascript">
    var n22d, model, ui, linkable; // global for debugging

    $(document).ready(function() {
        var x_rot = new Rotation(Math.PI/2, 1, 3);
        var ui_rot = new StaticTransform();
        var position = new Position(new Vector([0, 0, 0, -8]));
        model = new Model(klein_bottle(20, 60));
        model.transforms.a = [position, ui_rot, x_rot];
        var ball = new BallUI(model, 2.5);
        n22d = new N22d($('#n22d'), [model]);
        n22d.ondrag(function(mouse_drag) {
            // handle on a ball
            var handle_prev = ball.grab(mouse_drag.pos_prev);
            var handle = ball.grab(mouse_drag.pos);
            var swap = new BigMatrix().to_I();
            var space = new Space([handle_prev, handle]);
            if (space.basis.length != 2)
                return;
            var rot = space.inside(new Matrix(2, 2).to_rotation(mouse_drag.distance()*Math.PI*2));
            if (mouse_drag.move_event.shiftKey)
                swap.to_swap(3, 4);
            ui_rot.transform = swap.times(new BigMatrix(rot)).times(swap).times(ui_rot.transform);
        });
        n22d.animate();
    });
</script>
</head>

<body>
    <div id='n22d' style='min-height: 100%;'></div>
</body>

</html>
